<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Christian Posture Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Basic styling – you can tweak later -->
  <style>
    :root {
      --primary:#222;
      --secondary:#f5f5f5;
      --text:#222;
      --muted:#555;
      --border:#ddd;
    }
    * { box-sizing:border-box; }
    body {
      margin:0;
      padding:1.5rem;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      color:var(--text);
      background:#fff;
    }
    #cpm-app {
      max-width:800px;
      margin:0 auto;
    }
    #cpm-app h1 { font-weight:600; font-size:1.8rem; margin-bottom:0.75rem; }
    #cpm-app h2 { font-weight:600; font-size:1.3rem; margin:1rem 0 0.5rem; }
    #cpm-app p { line-height:1.5; }
    #cpm-app ul { padding-left:1.2rem; }
    .cpm-step { margin-top:1rem; }
    .cpm-option { display:block; margin:0.45rem 0; }
    .cpm-option input { margin-right:0.5rem; }
    .cpm-nav { margin-top:1.2rem; display:flex; gap:0.5rem; }
    .cpm-btn {
      padding:0.5rem 1.1rem;
      border-radius:4px;
      border:1px solid var(--primary);
      background:var(--primary);
      color:#fff;
      cursor:pointer;
      font-size:0.95rem;
    }
    .cpm-btn-secondary {
      background:var(--secondary);
      color:var(--primary);
    }
    .cpm-helper {
      font-size:0.9rem;
      color:var(--muted);
      margin-top:0.5rem;
    }
    #cpm-chart-wrapper {
      position:relative;
      width:100%;
      height:400px;
      border:1px solid var(--border);
      border-radius:4px;
      padding:0.5rem;
    }
    @media (max-width:600px) {
      body { padding:1rem; }
      #cpm-chart-wrapper { height:320px; }
    }
  </style>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div id="cpm-app">
  <h1>Christian Posture Map</h1>
  <div id="cpm-progress" class="cpm-helper"></div>

  <!-- STEP 0: Intro -->
  <div class="cpm-step" data-step="0">
    <p>
      This tool maps your answers onto a simple two-axis chart, based on two big instincts in Christian thought:
    </p>
    <ul>
      <li><strong>Authority &amp; Continuity (X-axis)</strong> – how much you lean toward “Bible alone” versus “Bible within the long memory of the Church”.</li>
      <li><strong>Grace &amp; Participation (Y-axis)</strong> – how you think God’s grace and human response fit together over a lifetime.</li>
    </ul>
    <p>
      Different Christians read the same passages with different emphases. This doesn’t judge who is right; it just shows where your own instincts tend to sit.
    </p>
    <p class="cpm-helper">
      This prototype has four questions. Later it can be expanded.
    </p>
    <button type="button" onclick="cpmNextStep()" class="cpm-btn">Start</button>
  </div>

  <!-- STEP 1: Tradition / Scripture -->
  <div class="cpm-step" data-step="1" style="display:none;">
    <h2>1. Bible and the Church’s memory</h2>
    <p>
      Over time, churches don’t just read the Bible; they also build habits, summaries, and ways of reading that get handed on.
      When there’s a tension between “what the Bible says” and “what churches have always taught”, where do you naturally land?
    </p>

    <label class="cpm-option">
      <input type="radio" name="q1" data-dx="-3" data-dy="0">
      In the end, only the Bible is binding. Later church teaching is human and can be ignored if it seems wrong.
    </label>
    <label class="cpm-option">
      <input type="radio" name="q1" data-dx="-1" data-dy="0">
      Church tradition can be useful background, but practically the Bible by itself is enough to decide things.
    </label>
    <label class="cpm-option">
      <input type="radio" name="q1" data-dx="2" data-dy="0">
      The Bible is primary, but the Church’s long memory and teaching help guard how we read it.
    </label>
    <label class="cpm-option">
      <input type="radio" name="q1" data-dx="3" data-dy="0">
      Christian belief is not just “Bible and me”, but also the living tradition passed on in and through the Church.
    </label>

    <p class="cpm-helper"><strong>Readings</strong></p>
    <ul class="cpm-helper">
      <li><strong>2 Thessalonians 2:15</strong> – “Stand firm and hold to the traditions that you were taught by us, either by word of mouth or by letter.”</li>
      <li><strong>1 Corinthians 11:2</strong> – “You maintain the traditions just as I handed them on to you.”</li>
      <li><strong>2 Timothy 1:13–14</strong> – “Hold to the standard of sound teaching you have heard from me… guard the good treasure entrusted to you.”</li>
      <li><strong>Acts 2:42</strong> – “They devoted themselves to the apostles’ teaching and fellowship…”</li>
    </ul>

    <div class="cpm-nav">
      <button type="button" onclick="cpmPrevStep()" class="cpm-btn cpm-btn-secondary">Back</button>
      <button type="button" onclick="cpmNextStep()" class="cpm-btn">Next</button>
    </div>
  </div>

  <!-- STEP 2: Faith & Works -->
  <div class="cpm-step" data-step="2" style="display:none;">
    <h2>2. Trust and life-change</h2>
    <p>
      The New Testament says that we are made right with God through faith, and also that faith without works is dead.
      When you put these together, what sounds closest to your instinct?
    </p>

    <label class="cpm-option">
      <input type="radio" name="q2" data-dx="0" data-dy="3">
      Trusting in Christ alone is what makes a person right with God. Good actions only show that this trust is real; they don’t play any role in being accepted.
    </label>
    <label class="cpm-option">
      <input type="radio" name="q2" data-dx="0" data-dy="1">
      God accepts us because of trust in Christ, but real trust always leads to a changed way of living if there’s time and opportunity.
    </label>
    <label class="cpm-option">
      <input type="radio" name="q2" data-dx="0" data-dy="-1">
      Trust and obedience belong together. It’s hard to draw a sharp line between “faith” and “what we then do with our lives”.
    </label>
    <label class="cpm-option">
      <input type="radio" name="q2" data-dx="0" data-dy="-3">
      Being saved is an ongoing relationship where God and the person keep working together through trust, choices, habits, and the life of the Church.
    </label>

    <p class="cpm-helper"><strong>Readings</strong></p>
    <ul class="cpm-helper">
      <li><strong>Romans 3:28</strong> – “We hold that a person is justified by faith apart from works of the law.”</li>
      <li><strong>Galatians 2:16</strong> – “A person is justified not by the works of the law but through faith in Jesus Christ.”</li>
      <li><strong>James 2:24</strong> – “You see that a person is justified by works and not by faith alone.”</li>
      <li><strong>Ephesians 2:8–10</strong> – “By grace you have been saved through faith… created in Christ Jesus for good works…”</li>
    </ul>

    <div class="cpm-nav">
      <button type="button" onclick="cpmPrevStep()" class="cpm-btn cpm-btn-secondary">Back</button>
      <button type="button" onclick="cpmNextStep()" class="cpm-btn">Next</button>
    </div>
  </div>

  <!-- STEP 3: Baptism -->
  <div class="cpm-step" data-step="3" style="display:none;">
    <h2>3. What do you think baptism does?</h2>
    <p>
      Some Christians see baptism mainly as a public declaration; others see it as a moment where God actually does something deep and invisible.
      Which description feels most like your instinct?
    </p>

    <label class="cpm-option">
      <input type="radio" name="q3" data-dx="-1" data-dy="3">
      It’s a public symbol showing that someone has already been saved by trusting in Christ. God has done the real work before the water.
    </label>
    <label class="cpm-option">
      <input type="radio" name="q3" data-dx="1" data-dy="1">
      It’s the official doorway into the visible Christian community. God can save people with or without it, but it’s an important act of obedience.
    </label>
    <label class="cpm-option">
      <input type="radio" name="q3" data-dx="2" data-dy="-1">
      It is one of the normal ways God gives or seals grace, even if God is not limited to that moment alone.
    </label>
    <label class="cpm-option">
      <input type="radio" name="q3" data-dx="3" data-dy="-3">
      It is a real sacrament: when the Church baptises, God truly acts in that moment for forgiveness and new life.
    </label>

    <p class="cpm-helper"><strong>Readings</strong></p>
    <ul class="cpm-helper">
      <li><strong>Acts 2:38</strong> – “Repent and be baptised… for the forgiveness of your sins…”</li>
      <li><strong>Romans 6:3–4</strong> – “All of us who have been baptised into Christ Jesus were baptised into his death…”</li>
      <li><strong>1 Peter 3:21</strong> – “Baptism… now saves you… as an appeal to God for a good conscience…”</li>
      <li><strong>John 3:5</strong> – “No one can enter the kingdom of God without being born of water and Spirit.”</li>
    </ul>

    <div class="cpm-nav">
      <button type="button" onclick="cpmPrevStep()" class="cpm-btn cpm-btn-secondary">Back</button>
      <button type="button" onclick="cpmNextStep()" class="cpm-btn">Next</button>
    </div>
  </div>

  <!-- STEP 4: Eucharist -->
  <div class="cpm-step" data-step="4" style="display:none;">
    <h2>4. What do you think is happening at Communion?</h2>
    <p>
      When Christians share bread and wine (or juice), traditions differ on how “real” Christ’s presence is in that act.
      Which statement sounds most like you?
    </p>

    <label class="cpm-option">
      <input type="radio" name="q4" data-dx="-2" data-dy="2">
      It is a symbolic memorial. Christ is present in our hearts and memory, not in the bread and wine themselves.
    </label>
    <label class="cpm-option">
      <input type="radio" name="q4" data-dx="1" data-dy="0">
      Christ is really present spiritually to those who receive in faith. The meal strengthens trust but doesn’t itself give grace.
    </label>
    <label class="cpm-option">
      <input type="radio" name="q4" data-dx="2" data-dy="-1">
      Christ is really present in a mysterious way we don’t fully define, and the Eucharist is one of the main ways God feeds us with grace.
    </label>
    <label class="cpm-option">
      <input type="radio" name="q4" data-dx="3" data-dy="-2">
      The bread and wine truly become Christ’s body and blood, and sharing in them is central to the Christian life.
    </label>

    <p class="cpm-helper"><strong>Readings</strong></p>
    <ul class="cpm-helper">
      <li><strong>Matthew 26:26–28</strong> – “This is my body… this is my blood…”</li>
      <li><strong>1 Corinthians 10:16</strong> – “The cup of blessing that we bless, is it not a sharing in the blood of Christ?”</li>
      <li><strong>1 Corinthians 11:23–26</strong> – “Do this in remembrance of me…”</li>
      <li><strong>John 6:53–56</strong> – “Unless you eat the flesh of the Son of Man and drink his blood, you have no life in you.”</li>
    </ul>

    <div class="cpm-nav">
      <button type="button" onclick="cpmPrevStep()" class="cpm-btn cpm-btn-secondary">Back</button>
      <button type="button" onclick="cpmShowResults()" class="cpm-btn">See My Map</button>
    </div>
  </div>

  <!-- STEP 5: Results -->
  <div class="cpm-step" data-step="5" style="display:none;">
    <h2>Your Christian Posture Map</h2>
    <p>
      This is a prototype using four questions. Treat it as a rough orientation, not a verdict.
      The map also shows approximate positions of some common Christian traditions and sub-traditions
      for comparison.
    </p>

    <div id="cpm-chart-wrapper">
      <canvas id="cpm-chart"></canvas>
    </div>

    <p id="cpm-coords" class="cpm-helper"></p>
    <p id="cpm-nearest" class="cpm-helper"></p>

    <p class="cpm-helper">
      X-axis: Authority &amp; Continuity (left = Scripture-alone emphasis, right = Scripture-within-tradition).<br>
      Y-axis: Grace &amp; Participation (up = faith-alone style language, down = cooperative / sacramental grace).
    </p>

    <button type="button" onclick="cpmRestart()" class="cpm-btn cpm-btn-secondary">Start Again</button>
  </div>
</div>

<script>
  let cpmCurrentStep = 0;
  let cpmChart = null;

  // Approximate locations of denominational clusters
  const CPM_REFERENCE_POINTS = [
    { label: 'Baptist (typical)', x: -4, y: 3, group: 'Evangelical / Low-church' },
    { label: 'Non-denominational Evangelical', x: -4, y: 2, group: 'Evangelical / Low-church' },
    { label: 'Reformed / Presbyterian', x: -3, y: 2, group: 'Evangelical / Low-church' },
    { label: 'Pentecostal / Charismatic', x: -2, y: 1, group: 'Evangelical / Low-church' },

    { label: 'Lutheran (confessional)', x: -1, y: 0, group: 'Magisterial Protestant' },
    { label: 'Methodist / Wesleyan', x: -1, y: -1, group: 'Magisterial Protestant' },

    { label: 'Anglican – Evangelical', x: 0, y: 1, group: 'Anglican' },
    { label: 'Anglican – Broad', x: 2, y: -0.5, group: 'Anglican' },
    { label: 'Anglican – Anglo-Catholic', x: 4, y: -3, group: 'Anglican' },

    { label: 'Catholic – Typical Parish', x: 6, y: -4, group: 'Catholic / Orthodox' },
    { label: 'Catholic – Traditionalist', x: 7, y: -5, group: 'Catholic / Orthodox' },
    { label: 'Catholic – Progressive', x: 5, y: -3, group: 'Catholic / Orthodox' },

    { label: 'Eastern Orthodox', x: 8, y: -5, group: 'Catholic / Orthodox' }
  ];

  // Colours per cluster
  const CPM_GROUP_COLORS = {
    'Evangelical / Low-church': 'rgba(54, 162, 235, 0.9)',       // blue
    'Magisterial Protestant':   'rgba(75, 192, 192, 0.9)',       // teal
    'Anglican':                 'rgba(255, 159, 64, 0.9)',       // orange
    'Catholic / Orthodox':      'rgba(153, 102, 255, 0.9)'       // purple
  };

  // Point shapes per tradition
  const CPM_POINT_STYLES = {
    'Baptist (typical)': 'triangle',
    'Non-denominational Evangelical': 'rect',
    'Reformed / Presbyterian': 'rectRot',
    'Pentecostal / Charismatic': 'star',
    'Lutheran (confessional)': 'circle',
    'Methodist / Wesleyan': 'cross',
    'Anglican – Evangelical': 'triangle',
    'Anglican – Broad': 'rectRounded',
    'Anglican – Anglo-Catholic': 'crossRot',
    'Catholic – Typical Parish': 'circle',
    'Catholic – Traditionalist': 'star',
    'Catholic – Progressive': 'rectRot',
    'Eastern Orthodox': 'dash'
  };

  // Short labels drawn next to each point
  const CPM_LABEL_ABBREVIATIONS = {
    'Baptist (typical)': 'Bap',
    'Non-denominational Evangelical': 'NDE',
    'Reformed / Presbyterian': 'Ref',
    'Pentecostal / Charismatic': 'Pent',
    'Lutheran (confessional)': 'Luth',
    'Methodist / Wesleyan': 'Meth',
    'Anglican – Evangelical': 'AE',
    'Anglican – Broad': 'AB',
    'Anglican – Anglo-Catholic': 'AC',
    'Catholic – Typical Parish': 'CT',
    'Catholic – Traditionalist': 'CTM',
    'Catholic – Progressive': 'CP',
    'Eastern Orthodox': 'EO'
  };

  // Plugin to draw tiny text labels above each reference point
  const cpmLabelPlugin = {
    id: 'cpmLabelPlugin',
    afterDatasetsDraw(chart, args, pluginOptions) {
      const { ctx } = chart;
      chart.data.datasets.forEach((dataset, datasetIndex) => {
        if (dataset.label === 'You') return;
        const meta = chart.getDatasetMeta(datasetIndex);
        if (!meta || meta.hidden) return;

        meta.data.forEach((element) => {
          const pos = element.tooltipPosition();
          const label = CPM_LABEL_ABBREVIATIONS[dataset.label];
          if (!label) return;
          ctx.save();
          ctx.font = '10px system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI"';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'bottom';
          ctx.fillStyle = '#444';
          ctx.fillText(label, pos.x, pos.y - 4);
          ctx.restore();
        });
      });
    }
  };

  if (typeof Chart !== 'undefined') {
    Chart.register(cpmLabelPlugin);
  }

  function cpmShowStep(step) {
    const steps = document.querySelectorAll('#cpm-app .cpm-step');
    steps.forEach(s => s.style.display = 'none');
    const target = document.querySelector('#cpm-app .cpm-step[data-step="' + step + '"]');
    if (target) {
      target.style.display = 'block';
      cpmCurrentStep = step;
    }

    const progressEl = document.getElementById('cpm-progress');
    if (!progressEl) return;
    if (step >= 1 && step <= 4) {
      progressEl.textContent = 'Question ' + step + ' of 4';
    } else {
      progressEl.textContent = '';
    }
  }

  function cpmNextStep() {
    // validate radios on steps 1–4
    if (cpmCurrentStep > 0 && cpmCurrentStep < 5) {
      const stepDiv = document.querySelector('#cpm-app .cpm-step[data-step="' + cpmCurrentStep + '"]');
      const radios = stepDiv.querySelectorAll('input[type="radio"]');
      const anyChecked = Array.from(radios).some(r => r.checked);
      if (!anyChecked) {
        alert('Please choose an option before continuing.');
        return;
      }
    }
    cpmShowStep(cpmCurrentStep + 1);
  }

  function cpmPrevStep() {
    if (cpmCurrentStep > 0) {
      cpmShowStep(cpmCurrentStep - 1);
    }
  }

  function cpmShowResults() {
    // validate last step
    const stepDiv = document.querySelector('#cpm-app .cpm-step[data-step="' + cpmCurrentStep + '"]');
    const radios = stepDiv.querySelectorAll('input[type="radio"]');
    const anyChecked = Array.from(radios).some(r => r.checked);
    if (!anyChecked) {
      alert('Please choose an option before continuing.');
      return;
    }

    let x = 0, y = 0;
    const allChecked = document.querySelectorAll('#cpm-app input[type="radio"]:checked');
    allChecked.forEach(r => {
      const dx = parseFloat(r.getAttribute('data-dx')) || 0;
      const dy = parseFloat(r.getAttribute('data-dy')) || 0;
      x += dx;
      y += dy;
    });

    cpmShowStep(5);

    const coordsEl = document.getElementById('cpm-coords');
    coordsEl.textContent = 'Your coordinates (prototype): X = ' + x.toFixed(1) + ', Y = ' + y.toFixed(1);

    // Find nearest reference point (roughly)
    let nearest = null;
    let bestDist = Infinity;
    CPM_REFERENCE_POINTS.forEach(ref => {
      const dx = ref.x - x;
      const dy = ref.y - y;
      const dist2 = dx*dx + dy*dy;
      if (dist2 < bestDist) {
        bestDist = dist2;
        nearest = ref;
      }
    });
    const nearestEl = document.getElementById('cpm-nearest');
    if (nearest && nearestEl) {
      nearestEl.textContent = 'Closest tradition on this map (very roughly): ' +
        nearest.label + ' (' + nearest.group + ').';
    }

    const ctx = document.getElementById('cpm-chart').getContext('2d');
    if (cpmChart) cpmChart.destroy();

    // You dataset
    const datasets = [
      {
        label: 'You',
        data: [{ x: x, y: y }],
        pointRadius: 7,
        pointHoverRadius: 9,
        backgroundColor: 'rgba(0, 0, 0, 0.9)',
        borderColor: 'rgba(0,0,0,1)',
        borderWidth: 2,
        pointStyle: 'circle'
      }
    ];

    // One dataset per tradition, coloured by cluster and given a shape
    CPM_REFERENCE_POINTS.forEach(ref => {
      const color = CPM_GROUP_COLORS[ref.group] || 'rgba(160, 160, 160, 0.9)';
      const style = CPM_POINT_STYLES[ref.label] || 'circle';
      datasets.push({
        label: ref.label,
        data: [{ x: ref.x, y: ref.y, label: ref.label }],
        pointRadius: 5,
        pointHoverRadius: 7,
        backgroundColor: color,
        borderColor: 'rgba(0, 0, 0, 0.7)',
        borderWidth: 1,
        pointStyle: style
      });
    });

    cpmChart = new Chart(ctx, {
      type: 'scatter',
      data: { datasets: datasets },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: {
            type: 'linear',
            position: 'bottom',
            min: -10,
            max: 10,
            title: { display: true, text: 'Authority & Continuity' },
            grid: { color: '#eee' }
          },
          y: {
            min: -10,
            max: 10,
            title: { display: true, text: 'Grace & Participation' },
            grid: { color: '#eee' }
          }
        },
        plugins: {
          legend: {
            display: true,
            position: 'right',
            labels: { boxWidth: 12 }
          },
          tooltip: {
            callbacks: {
              label: function (ctx) {
                const raw = ctx.raw || {};
                if (raw.label) {
                  return raw.label + ' (X ' + raw.x + ', Y ' + raw.y + ')';
                }
                return 'You (X ' + ctx.parsed.x + ', Y ' + ctx.parsed.y + ')';
              }
            }
          }
        }
      }
    });
  }

  function cpmRestart() {
    const radios = document.querySelectorAll('#cpm-app input[type="radio"]');
    radios.forEach(r => r.checked = false);
    cpmShowStep(0);
  }

  document.addEventListener('DOMContentLoaded', function () {
    cpmShowStep(0);
  });
</script>
</body>
</html>
